# 백엔드 개발 내용 요약

## 🎯 주요 개발 기능

### 1. 식물 종 식별 (Plant Identification)
- **이중 모델 자동 선택 시스템**
  - 모델1: `umutbozdag/plant-identity` (20종 전문, 로컬 실행)
  - 모델2: `PlantRecog API` (299종, 외부 API)
  - **자동 선택 로직**: 모델1 신뢰도 ≥ 50% → 모델1 사용, 미만 → 모델2 사용
- **자동 한국어 번역**: `facebook/nllb-200-distilled-600M` 모델로 영어 결과 한국어 변환
- **API 엔드포인트**: `POST /api/plant/analyze-auto`

### 2. 성장 예측 그래프 생성 (Growth Prediction Graph)
- **로지스틱 곡선 알고리즘 기반** (순수 수학 계산, AI 모델 미사용)
- **2가지 실선 지표 생성**:
  - 좋은 조건 성장 (초록색 실선): 최적 관리 시, 30% 빠른 성장
  - 나쁜 조건 성장 (빨간색 실선): 관리 부족 시, 30% 느린 성장
- **Y축 동적 범위 계산**: 식물 종별 특성에 맞는 최소/최대 크기 자동 설정
- **API 엔드포인트**: `POST /api/plant/growth-insight`

### 3. 월별 데이터 분석 (Monthly Data Analysis)
- **저장된 데이터 기반 분석**: 식물 분석 후 로컬 저장, 이후 재사용 가능
- **월별 데이터 테이블 생성**: 현재~12개월, 예상/좋음/나쁨 높이(cm) 제공
- **종합 분석 텍스트**: AI 기반 성장 경향 요약, 관리 팁, 주의사항
- **API 엔드포인트**: `GET /api/plant/monthly-data-analysis`

### 4. 텍스트 생성 시스템 (Text Generation)
- **템플릿 기반 생성** (기본값, 빠르고 안정적)
- **Qwen LLM 모델 지원** (선택적, 로컬 llama.cpp 사용)
  - 타임아웃: 10초 (초과 시 자동 템플릿 폴백)
  - 환경변수: `LLM_PROVIDER=none` (기본) 또는 `llama_cpp`
- **koGPT2 모델 비활성화**: Qwen 모델 사용으로 변경

### 5. 데이터 저장 및 관리
- **로컬 파일 저장**: JSON 파일 기반 (`../plant-care-final/data/identifications.json`)
- **자동 저장**: 식물 분석 시 자동 저장 (파일 해시 기반 중복 방지)
- **데이터 로드**: 저장된 데이터 기반 월별 분석 생성
- **디버깅 로그**: 저장/로드 과정 상세 로깅

## 🔧 기술 스택

- **웹 프레임워크**: FastAPI
- **딥러닝 프레임워크**: PyTorch
- **모델 라이브러리**: Transformers (Hugging Face)
- **로컬 LLM**: llama.cpp (Qwen 모델, 선택적)
- **이미지 처리**: Pillow
- **HTTP 요청**: Requests

## 📊 주요 개선 사항

1. **LLM 모델 변경**
   - ❌ koGPT2 비활성화
   - ✅ Qwen 모델 지원 추가 (선택적)
   - ✅ 템플릿 폴백 기본 사용 (빠르고 안정적)

2. **타임아웃 처리**
   - LLM 호출 타임아웃: 10초
   - 타임아웃 초과 시 자동 템플릿 폴백

3. **차트 데이터 포함**
   - `monthly-data-analysis` API에 `growth_graph` 필드 추가
   - 프론트엔드에서 차트 표시 가능

4. **에러 처리**
   - 상세한 에러 메시지 제공
   - HTTP 상태 코드 명확화 (400, 422, 500)

## 🚀 API 엔드포인트 요약

| 엔드포인트 | 메서드 | 기능 |
|-----------|--------|------|
| `/api/plant/analyze-auto` | POST | 식물 종 식별 (자동 모델 선택, 한국어) |
| `/api/plant/growth-insight` | POST | 성장 예측 그래프 생성 (이미지 있을 때) |
| `/api/plant/monthly-data-analysis` | GET | 월별 데이터 분석 (저장된 데이터 기반) |

## 💡 핵심 특징

- ✅ **모든 모델 로컬 실행** (API 키 불필요)
- ✅ **첫 실행 시 자동 다운로드** (Hugging Face Hub)
- ✅ **GPU 자동 감지** (가능하면 GPU, 아니면 CPU)
- ✅ **템플릿 폴백 기본 사용** (빠르고 안정적)
- ✅ **데이터 자동 저장** (재사용 가능)

